<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="app-data.html">

<dom-module id="log-out">
    <template>
        <style>
             :host {
                margin: 0;
                padding: 0;
            }
            
            paper-button {
                background: #f44336;
                color: #fff;
                font-weight: bold;
            }
            
            a {
                color: #fff;
                display: inline-block;
                font-size: 20px;
                text-decoration: none;
            }
        </style>

        <!-- MARKUP GOES HERE -->
        <app-data key="userData" data="{{storedUser}}"></app-data>

        <template is="dom-if" if="{{!link}}">
            <paper-button raised on-tap="logout">Log Out</paper-button>
        </template>

        <template is="dom-if" if="{{link}}">
            <a on-tap="logout" href>Log Out</a>
        </template>

        <iron-ajax id="registerLogoutAjax" 
               method="post" 
               content-type="application/json" 
               handle-as="json" 
               ></iron-ajax>
    </template>

    <script>
        (function () {
            Polymer({
                is: 'log-out',
                properties: {
                    storedUser: Object,
                    link: {
                        type: Boolean,
                        value: false
                    }
                },
                logout: function () {
                     var headers = {};
                     if (this.storedUser.token) {
                        headers.Authorization = 'Bearer ' + this.storedUser.token;
                     }
                     this.storedUser = null;
                     this.$.registerLogoutAjax.headers= headers;
                     this.$.registerLogoutAjax.url = 'http://localhost:2899/api/Account/Logout';
                     this.$.registerLogoutAjax.generateRequest();
                     this.fire('logout');
                }
            });
        }());
    </script>
</dom-module>